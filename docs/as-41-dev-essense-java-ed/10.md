10\. 安卓应用的剖析

不管你以前的编程经验如何，无论是基于视窗、苹果操作系统、Linux 还是 iOS，安卓开发很可能与你以前遇到的任何东西都不一样。

因此，本章的目的是提供对安卓应用程序架构背后的高级概念的理解。在此过程中，我们将详细探索可用于构建应用程序的各种组件，以及允许这些组件协同工作以创建内聚应用程序的机制。

10.1 安卓T2】活动

熟悉面向对象编程语言(如 Java、Kotlin、C++或 C#)的人会熟悉将应用程序功能的元素封装到类中的概念，这些类随后被实例化为对象并被操作来创建应用程序。由于 Android 应用程序是用 Java 和 Kotlin 编写的，现在仍然是这样。然而，安卓也将可重用组件的概念提升到了一个更高的层次。

安卓应用程序是通过将一个或多个称为活动的组件结合在一起而创建的。活动是应用程序功能的单个独立模块，通常与单个用户界面屏幕及其相应功能直接相关。例如，约会应用程序可能有一个活动屏幕，显示为当天设置的约会。该应用程序还可以利用由屏幕组成的第二个活动，用户可以在该屏幕上输入新的约会。

活动是完全可重用和可互换的构件，可以在不同的应用程序之间共享。例如，现有的电子邮件应用程序可能包含专门用于撰写和发送电子邮件的活动。开发人员可能正在编写一个同样需要发送电子邮件的应用程序。开发人员可以简单地使用现有电子邮件应用程序中的活动，而不是专门为新应用程序开发电子邮件撰写活动。

活动被创建为安卓活动类的子类，并且必须被实现，以便完全独立于应用程序中的其他活动。换句话说，共享活动不能依赖于在程序流中的已知点被调用(因为其他应用程序可能会以意想不到的方式使用该活动)，并且一个活动不能直接调用另一个活动的方法或访问另一个活动的实例数据。相反，这是通过使用意图和内容提供商来实现的。

默认情况下，活动不能向调用它的活动返回结果。如果需要此功能，活动必须作为发起活动的子活动专门启动。

10.2 安卓碎片

如上所述，活动通常表示应用程序中的单个用户界面屏幕。一种选择是使用单个用户界面布局和一个相应的活动类文件来构建活动。然而，更好的选择是将活动分成不同的部分。每个部分都被称为一个片段，每个片段都由用户界面布局的一部分和一个匹配的类文件(被声明为安卓片段类的子类)组成。在这个场景中，一个活动只是成为一个容器，一个或多个片段被嵌入其中。

事实上，片段提供了一种有效的替代方法，让每个用户界面屏幕由一个单独的活动来表示。相反，一个应用程序可以由一个在不同片段之间切换的活动组成，每个片段代表一个不同的应用程序屏幕。

10.3andro Id IntentT4s

意图是一个活动能够启动另一个活动并通过组成应用程序的活动实现流程的机制。意图包括对要执行的操作的描述，以及可选的要对其执行的数据。

意图可以是显式的，因为它们通过按类名引用活动来请求启动特定的活动，也可以是隐式的，通过陈述要执行的操作的类型或提供要对其执行操作的特定类型的数据。在隐式意图的情况下，安卓运行时将使用称为意图解析的过程来选择与意图指定的标准最匹配的活动来启动。

10.4 广播意图

另一种类型的意图，即广播意图，是发送给所有注册了“感兴趣的”广播接收器的应用程序的系统范围的意图。例如，安卓系统通常会发出广播意向，以指示设备状态的变化，如系统启动完成、外部电源连接到设备或屏幕打开或关闭。

广播意图可以是正常的(异步的)，因为它或多或少地同时被发送到所有感兴趣的广播接收器，或者是有序的，因为它一次被发送到一个接收器，在那里它可以被处理，然后或者被中止或者被允许被传递到下一个广播接收器。

10.5 广播接收器 s

广播接收器是应用程序能够响应广播意图的机制。广播接收器必须由应用程序注册，并配置有意图过滤器，以指示其感兴趣的广播类型。当匹配的意图被广播时，接收器将被安卓运行时调用，而不管注册接收器的应用程序当前是否正在运行。然后，接收者在返回之前有 5 秒钟的时间来完成要求其完成的任何任务(如启动服务、更新数据或向用户发出通知)。广播接收器在后台运行，没有用户界面。

10.6 安卓服务 s

安卓服务是在后台运行的进程，没有用户界面。它们可以从活动、广播接收器或其他服务中启动并随后进行管理。安卓服务非常适合应用程序需要继续执行任务，但不一定需要用户界面对用户可见的情况。尽管服务缺乏用户界面，但它们仍然可以使用通知和祝酒(屏幕上出现的小通知消息，不会中断当前可见的活动)向用户通知事件，并且还能够发出意向。

与许多其他进程相比，安卓运行时赋予服务更高的优先级，并且只有在万不得已的情况下，系统才会终止服务，以释放资源。但是，如果运行时确实需要终止一个服务，一旦有足够的资源再次可用，它就会自动重新启动。服务可以通过声明自己需要在前台运行来降低终止的风险。这是通过调用 startForeground()实现的。这仅建议在终止对用户体验有害的情况下使用(例如，如果用户正在收听服务流传输的音频)。

服务可能是实际解决方案的示例情况包括，如前所述，当应用程序不再活动时应该继续的音频流，或者当股票达到指定价格时需要通知用户的股票市场跟踪应用程序。

10.7 内容提供商

内容提供商实现了一种在应用程序之间共享数据的机制。任何应用程序都可以通过内容提供者的实现向其他应用程序提供对其底层数据的访问，包括添加、删除和查询数据的能力(取决于权限)。通过内容提供商定义的通用资源标识符(URI)提供对数据的访问。数据可以以文件或整个 SQLite 数据库的形式共享。

本机安卓应用程序包括许多标准的内容提供商，允许应用程序访问数据，如联系人和媒体文件。安卓系统上当前可用的内容提供商可以使用内容解析器来定位。

10.8 应用清单

将组成应用程序的各种元素结合在一起的粘合剂是应用程序清单文件。正是在这个基于 XML 的文件中，应用程序概述了组成整个应用程序的活动、服务、广播接收器、数据提供者和权限。

10.9 应用资源

除了包含字节码的清单文件和 Dex 文件之外，Android 应用程序包通常还包含资源文件的集合。这些文件包含用户界面中出现的字符串、图像、字体和颜色等资源，以及用户界面布局的 XML 表示。默认情况下，这些文件存储在应用程序项目层次结构的/res 子目录中。

10.10 应用上下文

编译应用程序时，会创建一个名为 R 的类，其中包含对应用程序资源的引用。应用程序清单文件和这些资源结合起来创建了所谓的应用程序上下文。这个由安卓上下文类表示的上下文可以在应用程序代码中使用，以便在运行时访问应用程序资源。此外，可以在应用程序的上下文中调用各种各样的方法来收集信息，并在运行时对应用程序的环境进行更改。

10.11 总结

为了创建一个安卓应用程序，许多不同的元素可以放在一起。在本章中，我们提供了活动、片段、服务、意图和广播接收器的高级概述，以及清单文件和应用程序资源的概述。

通过以活动和意图的形式创建单独的独立功能模块来促进最大程度的重用和互操作性，而应用程序之间的数据共享则通过内容提供商的实现来实现。

虽然活动集中在用户与应用程序交互的区域(活动本质上等同于单个用户界面屏幕，通常由一个或多个片段组成)，但后台处理通常由服务和广播接收器处理。

组成应用程序的组件在清单文件中为安卓运行时系统进行了概述，该文件与应用程序的资源相结合，代表了应用程序的上下文。

本章已经介绍了很多对于普通开发人员来说很可能是新的内容。不过，请放心，我们将在后续章节中对这些概念进行广泛的探索和实际应用，以确保为构建您自己的应用程序奠定坚实的知识基础。